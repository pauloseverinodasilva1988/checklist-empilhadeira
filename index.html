<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checklist - Empilhadeira Elétrica</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #5e1f1f;
      color: #ffffff;
      padding: 20px;
      margin: 0;
    }

    h1 {
      color: #f5c542;
      text-align: center;
      margin-bottom: 20px;
    }

    form {
      background-color: #3b1616;
      padding: 20px;
      border-radius: 12px;
      max-width: 650px;
      margin: auto;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.6);
    }

    label {
      display: block;
      margin-bottom: 6px;
      color: #f9f9f9;
      font-weight: bold;
    }

    input[type="text"],
    input[type="date"],
    input[type="time"],
    select,
    textarea {
      width: 100%;
      padding: 10px;
      background-color: #ffffff;
      color: #000;
      border: 2px solid #ccc;
      border-radius: 6px;
      margin-bottom: 12px;
      transition: border 0.3s ease-in-out;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: #d4af37;
      outline: none;
    }

    table {
      width: 100%;
      margin-bottom: 20px;
      border-collapse: collapse;
      background-color: #441a1a;
      border-radius: 8px;
      overflow: hidden;
    }

    th,
    td {
      padding: 12px;
      text-align: center;
      border: 1px solid #d4af37;
      color: #fff;
    }

    th {
      background-color: #6a2b2b;
      color: #ffd700;
    }

    button {
      background-color: #d4af37;
      color: #3b1616;
      font-weight: bold;
      padding: 12px 18px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      font-size: 16px;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #b89b2d;
    }

    .nao-conforme-info {
      display: none;
      margin-top: 10px;
    }

    .form-section {
      margin-bottom: 20px;
    }

    @media (max-width: 600px) {
      form {
        padding: 15px;
      }

      button {
        font-size: 14px;
      }

      th, td {
        font-size: 12px;
        padding: 8px;
      }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.2/xlsx.full.min.js"></script>
</head>
<body>
  <h1>Checklist - Empilhadeira</h1>


  <form id="checklistForm">
    <div class="form-section">
      <label>Nome:</label>
      <input type="text" name="nome" required>
    </div>

    <div class="form-section">
      <label>Data:</label>
      <input type="date" name="data" required>
    </div>

    <div class="form-section">
      <label>Tipo de Empilhadeira:</label>
      <select name="empilhadeira_tipo" required>
        <option value="a_gas">A Gás</option>
        <option value="eletrica">Elétrica</option>
        <option value="paleteira">Paleteira</option>
      </select>
    </div>

    <div class="form-section">
      <label>Turno:</label>
      <select name="turno" required>
        <option value="A">A</option>
        <option value="B">B</option>
        <option value="C">C</option>
      </select>
    </div>

    <div class="form-section">
      <label>Operação:</label>
      <select name="operacao" required>
        <option value="Início">Início</option>
        <option value="Fim">Fim</option>
      </select>
    </div>

    <div class="form-section">
      <label>Hora:</label>
      <input type="time" name="hora" required>
    </div>

    <h3>Checklist:</h3>
    <table>
      <tr><th>Item</th><th>Não conforme</th><th>Conforme</th></tr>
      <script>
        const itens = ["Pedais", "Bateria", "Direção", "Buzina", "Retrovisores", "Pneus", "Assento", "Cabine", "Protetor de carga", "Freio de estacionamento", "Painel de instrumentação", "Sinal luminoso", "Sinal sonoro", "Alavanca de comandos", "Garfos", "Corrente", "Faróis"];
        itens.forEach(item => {
          document.write(`
            <tr>
              <td>${item}</td>
              <td><input type="radio" name="item[${item}]" value="Não conforme" required></td>
              <td><input type="radio" name="item[${item}]" value="Conforme"></td>
            </tr>
          `);
        });
      </script>
    </table><br>

    <div class="form-section">
      <label>Alguma não conformidade?</label><br>
      <input type="radio" name="nao_conformidade" value="Sim" required> Sim
      <input type="radio" name="nao_conformidade" value="Não" required> Não
    </div>

    <div class="form-section nao-conforme-info" id="naoConformeInfo">
      <label>Descreva a não conformidade:</label>
      <textarea name="nao_conformidade_info" rows="4"></textarea>
    </div>

    <button type="submit">Salvar e Gerar Excel</button>
  </form>

  <script>
    // Exibir campo de descrição de não conformidade se "Sim" for selecionado
    document.querySelectorAll('input[name="nao_conformidade"]').forEach(radio => {
      radio.addEventListener('change', function() {
        const naoConformeInfo = document.getElementById('naoConformeInfo');
        if (this.value === 'Sim') {
          naoConformeInfo.style.display = 'block';
        } else {
          naoConformeInfo.style.display = 'none';
        }
      });
    });

    // Função para salvar os dados no localStorage
    function saveFormData(data) {
      const savedData = JSON.parse(localStorage.getItem('checklistData')) || [];
      savedData.push(data);
      localStorage.setItem('checklistData', JSON.stringify(savedData));
    }

    // Função para carregar dados salvos no formulário
    function loadFormData() {
      const savedData = JSON.parse(localStorage.getItem('checklistData')) || [];
      if (savedData.length > 0) {
        const lastData = savedData[savedData.length - 1];
        document.querySelector('[name="nome"]').value = lastData.nome;
        document.querySelector('[name="data"]').value = lastData.data;
        document.querySelector('[name="empilhadeira_tipo"]').value = lastData.empilhadeira_tipo;
        document.querySelector('[name="turno"]').value = lastData.turno;
        document.querySelector('[name="operacao"]').value = lastData.operacao;
        document.querySelector('[name="hora"]').value = lastData.hora;
        for (const [item, status] of Object.entries(lastData.item)) {
          document.querySelector(`input[name="item[${item}]"][value="${status}"]`).checked = true;
        }
        document.querySelector(`input[name="nao_conformidade"][value="${lastData.nao_conformidade}"]`).checked = true;
        if (lastData.nao_conformidade === 'Sim') {
          document.getElementById('naoConformeInfo').style.display = 'block';
          document.querySelector('[name="nao_conformidade_info"]').value = lastData.nao_conformidade_info;
        }
      }
    }

    // Função para gerar o Excel
    document.getElementById("checklistForm").addEventListener("submit", function(event) {
      event.preventDefault(); // Evitar o envio do formulário

      // Coletando os dados do formulário
      const formData = new FormData(event.target);
      const data = {};
      formData.forEach((value, key) => {
        if (!data[key]) {
          data[key] = value;
        } else {
          // Se houver múltiplos valores com o mesmo nome (ex. os itens do checklist)
          if (!Array.isArray(data[key])) {
            data[key] = [data[key]];
          }
          data[key].push(value);
        }
      });

      // Salvando os dados no localStorage
      saveFormData(data);

      // Criando o conteúdo da planilha
      const wsData = [
        ['Nome', data.nome],
        ['Data', data.data],
        ['Tipo de Empilhadeira', data.empilhadeira_tipo],
        ['Turno', data.turno],
        ['Operação', data.operacao],
        ['Hora', data.hora],
        ['Não Conformidade', data.nao_conformidade],
        ['Descrição da Não Conformidade', data.nao_conformidade_info || '']
      ];

      // Adicionando os itens do checklist
      for (const [item, status] of Object.entries(data.item)) {
        wsData.push([item, status.join(", ")]);
      }

      // Criando uma nova planilha
      const ws = XLSX.utils.aoa_to_sheet(wsData);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Checklist');

      // Gerando o arquivo Excel
      XLSX.writeFile(wb, 'checklist_empilhadeira.xlsx');
    });

    // Carregar dados do formulário quando a página for carregada
    window.onload = loadFormData;
  </script>

</body>
</html>
